From 730225f54363ede7896ab5345a033dca1da81210 Mon Sep 17 00:00:00 2001
From: Austin Hendrix <ahendrix@willowgarage.com>
Date: Tue, 9 Jul 2013 16:10:37 -0700
Subject: [PATCH 3/3] Fix build dependencies and add CMake config.

---
 CMakeLists.txt                     |  2 ++
 EMLConfig.cmake                    | 21 +++++++++++++++++++++
 eml-svn/tests/posix/CMakeLists.txt |  1 +
 3 files changed, 24 insertions(+)
 create mode 100644 EMLConfig.cmake

diff --git a/CMakeLists.txt b/CMakeLists.txt
index c4965f4..074b403 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1,3 +1,5 @@
 cmake_minimum_required(VERSION 2.8.3)
 
 add_subdirectory(eml-svn)
+
+install( FILES EMLConfig.cmake DESTINATION share/eml )
diff --git a/EMLConfig.cmake b/EMLConfig.cmake
new file mode 100644
index 0000000..28e3ed8
--- /dev/null
+++ b/EMLConfig.cmake
@@ -0,0 +1,21 @@
+# - Try to find EML
+# Once done this will define
+#  EML_FOUND - System has EML
+#  EML_INCLUDE_DIRS - The EML include directories
+#  EML_LIBRARIES - The libraries needed to use EML
+#  EML_DEFINITIONS - Compiler switches required for using EML
+
+find_path(EML_INCLUDE_DIR al/ethercat_master.h)
+
+find_library(EML_LIBRARY NAMES eml)
+
+set(EML_LIBRARIES ${EML_LIBRARY} )
+set(EML_INCLUDE_DIRS ${EML_INCLUDE_DIR} )
+
+include(FindPackageHandleStandardArgs)
+# handle the QUIETLY and REQUIRED arguments and set EML_FOUND to TRUE
+# if all listed variables are TRUE
+find_package_handle_standard_args(EML  DEFAULT_MSG
+   EML_LIBRARY EML_INCLUDE_DIR)
+
+mark_as_advanced(EML_INCLUDE_DIR EML_LIBRARY )
diff --git a/eml-svn/tests/posix/CMakeLists.txt b/eml-svn/tests/posix/CMakeLists.txt
index 8a1405f..732ec1c 100644
--- a/eml-svn/tests/posix/CMakeLists.txt
+++ b/eml-svn/tests/posix/CMakeLists.txt
@@ -7,3 +7,4 @@ TARGET_LINK_LIBRARIES(master_test eml)
 #TARGET_LINK_LIBRARIES(eval_test eml)
 TARGET_LINK_LIBRARIES(master_test pthread rt)
 SET_TARGET_PROPERTIES(master_test PROPERTIES LINK_FLAGS "${POSIX_USER_LDFLAGS}")
+ADD_DEPENDENCIES(master_test eml-dynamic)
-- 
1.9.1

